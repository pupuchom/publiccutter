<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã€æ°´æ™¶å®®ã€é•·æ–‡åˆ†å‰²ã‚«ãƒƒã‚¿ãƒ¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: "Hiragino Kaku Gothic ProN", sans-serif;
      background: #f3f6fa;
      padding: 10px 20px;
    }
    .container {
      max-width: 700px;
      margin: 10px auto;
      background: #fff;
      border-radius: 12px;
      padding: 15px 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    hr {
      margin: 10px 0;
      border: none;
      border-top: 2px dashed #888;
    }
    h2 {
      text-align: center;
      color: #4a7dbb;
      margin: 4px 0 6px;
    }
    textarea {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-bottom: 10px;
      box-sizing: border-box;
      outline: none;
      box-shadow: none;
    }
    button {
      padding: 10px 15px;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      background-color: #4a7dbb;
      color: white;
      cursor: pointer;
      margin: 10px 5px 0 0;
      transition: background-color 0.3s;
      outline: none;
    }
    button:hover {
      background-color: #365f99;
    }
    button:focus,
    button:active,
    button:focus-visible {
      outline: none !important;
      box-shadow: none !important;
    }
    .split-button {
      background-color: #e29950;
    }
    .split-button:hover {
      background-color: #dd8731;
    }
    .comment {
      font-weight: bold;
      margin: 8px 0 4px;
      padding: 6px 12px;
      border-left: 4px solid #4a7dbb;
      background: #eef3fb;
      border-radius: 6px;
    }
    .copy-button {
      margin-top: 5px;
      background-color: #4b88d2;
    }
    .copy-button:hover {
      background-color: #3378cc;
    }
    .mix-copy-button {
      margin-top: 5px;
      padding: 10px 15px;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      background-color: #f4aa36;
      color: #ffffff;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .mix-copy-button:hover {
      background-color: #ffd86b;
    }
    .mix-copied {
      background-color: #127d15 !important;
      color: white !important;
    }
    .copied {
      background-color: #0e078d !important;
      color: white !important;
    }
    .copied:hover {
      background-color: #00008f !important;
    }
    .part-label-wrapper {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .part-label {
      display: inline-block;
      background-color: #e6f0fa;
      color: #4a7dbb;
      font-weight: bold;
      padding: 2px 8px;
      border-radius: 6px;
      font-size: 0.9rem;
      margin: 4px 0;
    }
    .part-check {
      margin-left: 10px;
      transform: scale(1.2);
    }
.mode-select {
  margin: 12px 0;
  display: grid;
  grid-template-columns: repeat(2, auto);
  grid-auto-rows: minmax(40px, auto);
  justify-content: start;
  gap: 6px 12px;
}

.mode-select label span {
  display: inline-block;
  height: 36px;
  line-height: 36px;
  padding: 0 14px;
  border-radius: 999px;
  font-size: 0.82rem;
  font-weight: 500;
  cursor: pointer;
  color: #2c6fa9;
  background-color: #eef6fd;
  border: 1px solid #d0e4f7;
  user-select: none;
  transition: all 0.2s ease;
  text-align: center;
  box-sizing: border-box;
}
    .mode-select input[type="radio"] {
      display: none;
    }
    .mode-select input[type="radio"]:checked + span {
      background-color: #4a7dbb;
      color: #fff;
      font-weight: 500;
      border: 1px solid transparent;
      box-shadow: 0 0 0 4px rgba(74, 125, 187, 0.3);
    }
    #countStatus, #modeDescription, #totalStats {
      color: #555;
      margin-top: 15px;
      font-weight: bold;
    }
    #modeDescription, #mixDescription {
      color: #444;
      font-size: 0.9rem;
      margin-left: 5px;
      font-weight: bold;
    }
    #totalStats {
      color: #555;
    }
    .part-box {
      width: 100%;
      box-sizing: border-box;
      height: 200px;
      overflow: auto;
      resize: vertical;
    }

#scrollButtons {
  position: fixed;
  bottom: 20px;
  right: 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  z-index: 999;
}
#scrollButtons button {
  background: #ffffff;
  border: 1px solid #aaa;
  border-radius: 6px;
  padding: 8px;
  font-size: 16px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  cursor: pointer;
}
#leftToast {
  position: fixed;
  padding: 10px 20px;
  background: linear-gradient(135deg, rgba(74, 125, 187, 0.95), rgba(100, 149, 237, 0.95));
  color: white;
  font-size: 14px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(74, 125, 187, 0.4);
  opacity: 0;
  transition: opacity 0.3s ease;
  z-index: 9999;
  pointer-events: none;
  font-family: "Hiragino Kaku Gothic ProN", sans-serif;
  white-space: nowrap;
  font-weight: 500;
}

.cute-popup-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 9998;
  display: flex;
  align-items: center;
  justify-content: center;
}
.cute-popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #f0f8ff;
  border: 2px solid #6495ed;
  padding: 20px 30px;
  border-radius: 12px;
  font-size: 16px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  z-index: 9999;
  text-align: center;
  color: #336;
  font-family: 'Hiragino Kaku Gothic ProN', sans-serif;
  max-width: 400px;
  width: 280px;
}
.cute-popup-title {
  font-size: 18px;
  margin-bottom: 10px;
  font-weight: bold;
}
.cute-popup-message {
  margin-bottom: 15px;
  line-height: 1.5;
}
.cute-popup-button {
  margin-top: 15px;
  padding: 8px 20px;
  background-color: #66aaff;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  cursor: pointer;
  transition: background-color 0.3s;
}
.cute-popup-button:hover {
  background-color: #4a8fff;
}
#mixOutputArea h3 {
  margin: 16px 0 12px 0;
  padding: 8px 0;
  color: #3366cc;
  font-size: 1.1rem;
  line-height: 1.4;
}
#mixOutputArea > div {
  margin: 10px 0 14px 0;
  display: block;
  line-height: 1.5;
}

/* ãƒŸãƒƒã‚¯ã‚¹æ–‡å­—æ•°ãƒ©ãƒ™ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å‡ºãªã„ä»•æ§˜ï¼‰ */
.mix-clear-label {
  cursor: pointer;
  user-select: none;
  transition: color 0.2s ease;
}

.mix-clear-label:active {
  color: #ff6b9d;
}

/* ãºãŸã‚¹ãƒšãƒ¼ã‚¹ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
@keyframes petaModalBounce {
  0% {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.8);
  }
  60% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1.05);
  }
  100% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
}

/* ãºãŸã‚¹ãƒšãƒ¼ã‚¹ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
#petaModal {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #fff;
  padding: 20px;
  border: 2px solid #89c;
  z-index: 1000;
  border-radius: 1em;
  width: 500px;
  max-width: 80%;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  transition: width 0.4s ease, height 0.4s ease, max-width 0.4s ease, max-height 0.4s ease, padding 0.4s ease;
}

#petaModal.show {
  display: block;
  animation: petaModalBounce 0.4s ease-out forwards;
}

#petaModal.expanded {
  width: 85vw !important;
  max-width: 85vw !important;
  height: 80vh !important;
  max-height: 80vh !important;
  padding: 30px !important;
  top: 50% !important;
  transform: translate(-50%, -50%) !important;
}

#petaModal.expanded #petaArea {
  /* ã‚¸ã‚§ãƒã¡ã‚ƒã‚“ã®è»¢å†™ãƒœãƒƒã‚¯ã‚¹ã¨åŒã˜ã‚ªãƒ•ã‚»ãƒƒãƒˆã§çµ±ä¸€ */
  height: calc(80vh - 250px) !important;
  font-size: 16px !important;
}

/* æ‹¡å¤§æ™‚ã®ãƒœã‚¿ãƒ³é…ç½®ï¼š2æ®µæ§‹æˆ */
#petaModal.expanded #petaButtonsWrap {
  display: flex;
  flex-direction: column;
  gap: 0px;
}

#petaModal.expanded #petaButtonsRow1 {
  display: flex;
  gap: 5px;
  flex-wrap: nowrap;
  justify-content: center;
  margin-bottom: 0;
  overflow-x: auto;
}

#petaModal.expanded #petaButtonsRow1 button {
  flex-shrink: 0;
  white-space: nowrap;
}

#petaModal.expanded #petaButtonsRow2 {
  display: flex;
  justify-content: center;
  margin-top: 0px;
  margin-bottom: 10px;
}

#petaModal h3 {
  margin-top: 0;
  color: #4a7dbb;
  text-align: center;
}

#petaArea {
  width: 100%;
  height: 200px;
  padding: 10px;
  font-size: 1rem;
  border-radius: 8px;
  border: 1px solid #ccc;
  margin: 10px 0;
  box-sizing: border-box;
  white-space: pre-wrap;
  resize: vertical;
  transition: height 0.4s ease, font-size 0.4s ease;
}

/* é€šå¸¸æ™‚ã®ãƒœã‚¿ãƒ³é…ç½®ï¼š2æ®µå¼ */
#petaButtonsWrap {
  display: flex;
  flex-direction: column;
  gap: 0px;
}

#petaButtonsRow1 {
  display: flex;
  gap: 5px;
  flex-wrap: nowrap;
  justify-content: center;
  margin-bottom: 0;
  overflow-x: auto;
}

#petaButtonsRow1 button {
  flex-shrink: 0;
  white-space: nowrap;
}

#petaButtonsRow2 {
  display: flex;
  justify-content: center;
  margin-top: 0px;
  margin-bottom: 10px;
}

#petaPaste, #petaUndo, #petaClear, #petaCopy, #closePeta {
  padding: 10px 15px;
  font-size: 1rem;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  margin: 0;
  transition: background-color 0.3s;
  flex: 0 1 auto;
  white-space: nowrap;
  color: white;
}

#petaPaste {
  background-color: #4a7dbb;
}

#petaPaste:hover {
  background-color: #365f99;
}

#petaUndo {
  background-color: #f39c12;
}

#petaUndo:hover {
  background-color: #e67e22;
}

#petaClear {
  background-color: #e74c3c;
}

#petaClear:hover {
  background-color: #c0392b;
}

#petaCopy {
  background-color: #27ae60;
}

#petaCopy:hover {
  background-color: #229954;
}

#closePeta {
  background-color: #e279de;
}

#closePeta:hover {
  background-color: #db5cd7;
}

#openPeta {
  background-color: #9b59b6;
}

#openPeta:hover {
  background-color: #8e44ad;
}

#openPeta:focus,
#openPeta:active,
#openPeta:focus-visible,
#petaPaste:focus,
#petaPaste:active,
#petaPaste:focus-visible,
#petaUndo:focus,
#petaUndo:active,
#petaUndo:focus-visible,
#petaCopy:focus,
#petaCopy:active,
#petaCopy:focus-visible,
#petaClear:focus,
#petaClear:active,
#petaClear:focus-visible,
#closePeta:focus,
#closePeta:active,
#closePeta:focus-visible {
  outline: none !important;
  box-shadow: none !important;
}

/* ãƒ‘ã‚½ã‚³ãƒ³ç‰ˆï¼šãƒœã‚¿ãƒ³å¹…ã‚’å†…å®¹ã«å¿œã˜ãŸã‚µã‚¤ã‚ºã« */
@media (min-width: 768px) {
  div[style*="display: flex"] button[onclick="pasteFromClipboard()"],
  div[style*="display: flex"] button#openPeta {
    flex: 0 1 auto !important;
    font-size: 1rem !important;
    padding: 10px 15px !important;
  }
}

/* ãºãŸãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ */
.mode-btn {
  font-weight: bold;
  border: none;
  border-radius: 10px;
  padding: 6px 14px;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 0 0 transparent;
}

/* ãƒ’ãƒãƒã‚®ãƒ¢ãƒ¼ãƒ‰ï¼ˆscientistï¼‰ */
.mode-btn.scientist {
  background: #eef9ff;
  color: #0066aa;
  box-shadow: 0 0 10px #9be0ff;
}

/* ã‚¶ã‚¯ãƒ©ãƒ³ãƒ¢ãƒ¼ãƒ‰ï¼ˆastroï¼‰ */
.mode-btn.astro {
  background: #f6f1ff;
  color: #8844cc;
  box-shadow: 0 0 10px #d5b3ff;
}

  </style>
</head>
<body>
  <div class="container">
    <h2 onclick="location.reload()" style="cursor: pointer; user-select: none; transition: opacity 0.2s;" onmouseover="this.style.opacity='0.7'" onmouseout="this.style.opacity='1'">ã€æ°´æ™¶å®®ã€é•·æ–‡åˆ†å‰²ã‚«ãƒƒã‚¿ãƒ¼</h2>
    <textarea id="longText" rows="10" placeholder="ã“ã“ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’è²¼ã£ã¦ãã ã•ã„"></textarea>
    <div style="display: flex; gap: 5px; flex-wrap: nowrap; justify-content: flex-start;">
      <button onclick="pasteFromClipboard()" style="flex: 1; min-width: 0; font-size: 0.9rem; padding: 10px 8px;">ğŸ“ƒãƒšãƒ¼ã‚¹ãƒˆã™ã‚‹</button>
      <button onclick="clearLongText()">ğŸ—‘ã‚¯ãƒªã‚¢</button>
      <button id="openPeta" style="flex: 1; min-width: 0; font-size: 0.9rem; padding: 10px 8px;">ğŸ”±ãºãŸã‚¹ãƒšãƒ¼ã‚¹</button>
    </div>

    <div class="mode-select">
      <label><input type="radio" name="mode" value="length" checked onclick="showModeDescription('æ–‡å­—æ•°ã§æŒ‡å®šã—ãŸé•·ã•ã”ã¨ã«åˆ†å‰²ã—ã¾ã™')"><span>ğŸ“æ–‡å­—æ•°ãƒ¢ãƒ¼ãƒ‰</span></label>
      <label><input type="radio" name="mode" value="novel" onclick="showModeDescription('æ®µè½ãƒ»æ”¹è¡Œå˜ä½ã§èª­ã¿ã‚„ã™ãåˆ†å‰²ã—ã¾ã™')"><span>ğŸ“–å°èª¬ãƒ¢ãƒ¼ãƒ‰</span></label>
      <label><input type="radio" name="mode" value="smartParagraph" onclick="showModeDescription('æ®µè½ãƒ»æ”¹è¡Œã‚’å´©ã•ãšã€è¤‡æ•°æ®µè½ã‚’æŸã­ã¦è‡ªç„¶ã«åˆ†å‰²ã—ã¾ã™')"><span>ğŸ“šæ®µè½ãƒ¢ãƒ¼ãƒ‰</span></label>
     <label><input type="radio" name="mode" value="symbolCut"
    onclick="showModeDescription('â—ã‚„â—†ãªã©ã€è¨˜å·ã ã‘ã®è¡Œã‚’åŒºåˆ‡ã‚Šã¨ã—ã¦åˆ†å‰²ã—ã¾ã™')"><span>ğŸ”µè¨˜å·ã‚«ãƒƒãƒˆ</span></label>
      <label><input type="radio" name="mode" value="code" onclick="showModeDescription('JavaScriptã‚„CSSã®æ§‹æ–‡ã‚’å£Šã•ãªã„ã‚ˆã†ã«è³¢ãåˆ†å‰²ã—ã¾ã™')"><span>ğŸ“ã‚³ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰</span></label>
      <label><input type="radio" name="mode" value="function" onclick="showModeDescription('JavaScripté–¢æ•°ã”ã¨ã«åˆ†å‰²ã—ã¾ã™')"><span>âš™ï¸é–¢æ•°ãƒ¢ãƒ¼ãƒ‰</span></label>
      <label><input type="radio" name="mode" value="composition" onclick="showModeDescription('htmlâ†’headâ†’bodyâ†’/htmlã®æ§‹æˆé †ã«åˆ†å‰²ã—ã¾ã™')"><span>âœï¸æ§‹æˆãƒ¢ãƒ¼ãƒ‰</span></label>
      <label><input type="radio" name="mode" value="structureParts" onclick="showModeDescription('style,script,bodyãªã©ã‚’éƒ¨å“ãƒ‘ãƒ¼ãƒ„ã”ã¨ã«æŠ½å‡ºã—ã¾ã™')"><span>ğŸ§©æ§‹é€ ãƒ‘ãƒ¼ãƒ„ãƒ¢ãƒ¼ãƒ‰</span></label>
      <label><input type="radio" name="mode" value="headBodySplit" onclick="showModeDescription('</head>ã§çœŸã£äºŒã¤ã«åˆ†å‰²ã™ã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãƒ¢ãƒ¼ãƒ‰ã§ã™')"><span>ğŸ“Œhead/bodyã‚«ãƒƒãƒˆ</span></label>
    </div>
    <div id="modeDescription">æ–‡å­—æ•°ã§æŒ‡å®šã—ãŸé•·ã•ã”ã¨ã«åˆ†å‰²ã—ã¾ã™</div>

    <span style="white-space: nowrap;"><label>ğŸ” åˆ†å‰²æ–‡å­—æ•°ï¼š</label><input type="number" id="splitLength" value="4000" style="width:100px;"></span>
    <button onclick="splitText()" class="split-button">âœ‚ï¸åˆ†å‰²ã™ã‚‹</button>
    <div id="totalStats">ğŸ“‹ãƒˆãƒ¼ã‚¿ãƒ«ï¼š0æ–‡å­—ãƒ»0è¡Œ</div>
    <div id="countStatus">ğŸ§®ãƒ‘ãƒ¼ãƒ„æ•°ï¼š0/0</div>
    <div id="resultArea" style="margin-top: 30px;"></div>

    <hr>
    <h3 style="font-size: 1.2rem; color: #3366cc; background: #eef5ff; padding: 8px 14px; border-left: 6px solid #66aaff; border-radius: 6px; margin-top: 12px; margin-bottom: 8px; box-shadow: 0 1px 3px rgba(51, 102, 204, 0.15);">ğŸ“ãƒŸãƒƒã‚¯ã‚¹ã‚¨ãƒªã‚¢</h3>
    <div id="mixDescription">é¸ã‚“ã ãƒ‘ãƒ¼ãƒ„ã‚’çµåˆã—ã¦å‡ºåŠ›ã—ã¾ã™</div><br>
    <div style="margin-top:10px;">
      <label class="mix-clear-label" onclick="clearMixMaxLength()">ğŸ”¢ãƒŸãƒƒã‚¯ã‚¹æ–‡å­—æ•°ï¼š</label>
      <input type="number" id="mixMaxLength" value="4000" style="width:100px;">
    </div>
    <button onclick="mixSelectedParts()">âšœï¸ãƒŸãƒƒã‚¯ã‚¹å‡ºåŠ›</button>

    <div id="mixOutputArea" style="margin-top: 10px;"></div>
  </div>

  <!-- ãºãŸã‚¹ãƒšãƒ¼ã‚¹ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="petaModal">
    <h3><span id="petaExpandBtn" style="cursor:pointer; margin-left: 8px;" onclick="togglePetaFullscreen(event)">âœ¨ãºãŸã‚¹ãƒšãƒ¼ã‚¹âœ¨</span></h3>
    <div id="petaModeWrap" style="margin-bottom: 10px; text-align: center;">
      <button id="petaModeToggle" class="mode-btn scientist">ğŸ§ª1è¡Œãƒ¢ãƒ¼ãƒ‰</button>
    </div>
    <textarea id="petaArea" rows="10" placeholder="ã“ã“ã«ãºãŸãºãŸè¿½è¨˜ã—ã¦ã„ãã¾ã™â™ª"></textarea>
    <p id="petaCharCount" style="text-align: center; font-weight: bold; margin-top: 8px; color: #2ea1ff;">
      ğŸ“æ–‡å­—æ•°ï¼š0å­—
    </p>
    <div id="petaButtonsWrap" style="margin-top: 15px;">
      <div id="petaButtonsRow1" style="display: flex; gap: 5px; flex-wrap: nowrap; justify-content: center; margin-bottom: 10px;">
        <button id="petaPaste">ğŸ“ƒï¸ãºãŸã£ï¼</button>
        <button id="petaCopy">ğŸªã‚³ãƒ”ãƒ¼</button>
        <button id="petaClear">ğŸ—‘ãºãŸæ¶ˆå»</button>
      </div>
      <div id="petaButtonsRow2" style="display: flex; gap: 5px; justify-content: center;">
        <button id="petaUndo">â†©æˆ»ã™</button>
        <button id="closePeta">â˜„ï¸é–‰ã˜ã‚‹</button>
      </div>
    </div>
  </div>

<script>
const characters = [
  {
    name: "ã‚¶ã‚¯ãƒ©ãƒ³",
    comments: [
      "ã€Œãˆã¸ã¸ã€åˆ†ã‘ã¦ãŠã„ãŸã‚ˆâ™ªã€",
      "ã€Œã“ã‚Œã§ãƒ’ãƒãƒã‚®ã‚‚å›°ã‚‰ãªã„ã­ï½ã€",
      "ã€Œåˆ†ã‘ãŸã‚‰ã¡ã‚‡ã£ã¨ã‚¹ãƒƒã‚­ãƒªã—ãŸæ°—ãŒã™ã‚‹â™ªã€",
      "ã€Œãµãµã£ã€ã“ã‚Œãã‚‰ã„æœé£¯å‰ã ã‚ˆï½ã€",
      "ã€Œåƒ•ã£ã¦åˆ†å‰²ã®å¤©æ‰ã ã£ãŸã‚Šã—ã¦ï¼Ÿ(ç¬‘)ã€"
    ]
  },
  {
    name: "ãƒ’ãƒãƒã‚®",
    comments: [
      "ã€Œâ€¦â€¦åˆ†å‰²å®Œäº†ã ã€‚ç¢ºèªã—ã¦ãã‚Œã€",
      "ã€Œèª­ã‚€ã®ãªã‚‰ã€ä»Šã ã€",
      "ã€Œè§£æå¯èƒ½ãªã‚µã‚¤ã‚ºã«æ•´ãˆãŸã€‚é ¼ã‚€ã€",
      "ã€Œâ€¦â€¦æ•°å€¤ä¸Šã¯å•é¡Œãªã„ã¯ãšã ãŒã€",
      "ã€Œåˆ†å‰²å‡¦ç†ã€çµ‚äº†ã€‚æ¬¡ã¯è©•ä¾¡ãƒ•ã‚§ãƒ¼ã‚ºã ã€"
    ]
  },
  {
    name: "ã‚·ã‚§ãƒ©ã‚¤ãƒˆ",
    comments: [
      "ã€Œã“ã®åˆ†å‰²ã€æˆ‘ãŒå‘½ä»¤ã«ã‚ˆã‚‹ã‚‚ã®ã ã€",
      "ã€Œãƒ’ãƒãƒã‚®ã€ãã®å‡¦ç†ã§å•é¡Œãªã„ã®ã‹ï¼Ÿã€",
      "ã€Œãƒ’ãƒãƒã‚®ã€ãã®å‡¦ç†ã§å•é¡Œãªã„ã®ã‹ï¼Ÿã€",      "ã€Œãƒ’ãƒãƒã‚®ã€ãã®å‡¦ç†ã§å•é¡Œãªã„ã®ã‹ï¼Ÿã€",      "ã€Œãƒ’ãƒãƒã‚®ã€ãã®å‡¦ç†ã§å•é¡Œãªã„ã®ã‹ï¼Ÿã€",      "ã€Œãƒ’ãƒãƒã‚®ã€ãã®å‡¦ç†ã§å•é¡Œãªã„ã®ã‹ï¼Ÿã€",      "ã€Œãƒ’ãƒãƒã‚®ã€ãã®å‡¦ç†ã§å•é¡Œãªã„ã®ã‹ï¼Ÿã€",
      "ã€Œãµã‚“ã€åˆ†ã‘ãŸã ã‘ã§æº€è¶³ã™ã‚‹ãªã‚ˆã€",
      "ã€Œç§ã®è¨±å¯ãªãçµ±åˆã™ã‚‹ãªã€‚åˆ†ã‹ã£ãŸãªï¼Ÿã€",
      "ã€Œå…¨ã¦ã®æ–­ç‰‡ã¯æˆ‘ãŒç£å ´ã®å†…ã«ã‚ã‚‹ã€"
    ]
  },
  {
    name: "ãƒ´ã‚§ãƒ«ãƒ¡",
    comments: [
      "ã€Œä¸€ã¤ä¸€ã¤ã€ä¸å¯§ã«èª­ã‚“ã§ã„ãã¾ã—ã‚‡ã†ã€",
      "ã€Œâ€¦â€¦ã“ã†ã„ã†å‡¦ç†ã€ç§ã¯å«Œã„ã˜ã‚ƒãªã„ã€",
      "ã€Œæ•´ç„¶ã¨ä¸¦ã‚“ã ãƒ†ã‚­ã‚¹ãƒˆã€æ°—æŒã¡ãŒã„ã„ã§ã™ã­ã€",
      "ã€Œã“ã‚Œã§å¾Œã‹ã‚‰ã§ã‚‚è¿½è·¡ã—ã‚„ã™ããªã‚Šã¾ã—ãŸã€",
      "ã€Œåˆ†å‰²ãƒ­ã‚°ã¯ä¿å­˜ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€å¿µã®ãŸã‚ã€"
    ]
  }
];

function showModeDescription(text) {
  document.getElementById("modeDescription").textContent = text;
}

function clearMixMaxLength() {
  document.getElementById("mixMaxLength").value = "";
  showToast('ã‚¯ãƒªã‚¢ã—ãŸã‚ˆï¼');
}

function showCutePopup(message, title = "âš ï¸å…¥åŠ›ãƒŸã‚¹ã‹ã‚‚ï¼Ÿ") {
  // æ—¢å­˜ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’å‰Šé™¤
  const existing = document.querySelector('.cute-popup-overlay');
  if (existing) {
    existing.remove();
  }
  
  const overlay = document.createElement("div");
  overlay.className = "cute-popup-overlay";
  overlay.innerHTML = `
    <div class="cute-popup">
      <div class="cute-popup-title">${title}</div>
      <div class="cute-popup-message">${message}</div>
      <button class="cute-popup-button" onclick="this.closest('.cute-popup-overlay').remove()">OK</button>
    </div>
  `;
  
  document.body.appendChild(overlay);
  
  // èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§ã‚‚é–‰ã˜ã‚‹
  overlay.addEventListener('click', (e) => {
    if (e.target === overlay) {
      overlay.remove();
    }
  });
  
  // ESCã‚­ãƒ¼ã§ã‚‚é–‰ã˜ã‚‹
  const handleEsc = (e) => {
    if (e.key === 'Escape') {
      overlay.remove();
      document.removeEventListener('keydown', handleEsc);
    }
  };
  document.addEventListener('keydown', handleEsc);
}

function updateTotalStats() {
  const text = document.getElementById("longText").value;
  // æ”¹è¡Œã‚’é™¤å»ã—ãŸå®Ÿéš›ã®æ–‡å­—æ•°
  const actualChars = text.replace(/\n/g, '').length;
  const totalLines = text.split("\n").length;
  document.getElementById("totalStats").textContent =
    `ğŸ“‹ãƒˆãƒ¼ã‚¿ãƒ«ï¼š${actualChars}æ–‡å­—ãƒ»${totalLines}è¡Œ`;
}

function pasteFromClipboard() {
  navigator.clipboard.readText().then(text => {
    document.getElementById("longText").value = text;
    updateTotalStats();
  }).catch(err => {
    console.log('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰èª­ã¿å–ã‚Šå¤±æ•—');
  });
}

function clearLongText() {
  document.getElementById("longText").value = "";
  document.getElementById("resultArea").innerHTML = "";
  document.getElementById("mixOutputArea").innerHTML = "";
  document.getElementById("countStatus").textContent = "ğŸ§®ãƒ‘ãƒ¼ãƒ„æ•°ï¼š0/0";
  document.getElementById("totalStats").textContent = "ğŸ“‹ãƒˆãƒ¼ã‚¿ãƒ«ï¼š0æ–‡å­—ãƒ»0è¡Œ";
}

function updateCount() {
  const checks = document.querySelectorAll('.part-check');
  const total = checks.length;
  const selected = [...checks].filter(cb => cb.checked).length;
  document.getElementById("countStatus").textContent =
    `ğŸ§®${selected}/${total}ãƒ‘ãƒ¼ãƒ„é¸æŠä¸­`;
}

function isGoodCutPoint(line) {
  const trimmedLine = line.trim();

  if (trimmedLine === '') return true;

  if (trimmedLine === '}' || trimmedLine === '};' || trimmedLine === '},') return true;

  if (trimmedLine.endsWith('}') &&
      !trimmedLine.includes('function') &&
      !trimmedLine.includes('if') &&
      !trimmedLine.includes('for')) return true;

  if (trimmedLine.startsWith('<') &&
      !trimmedLine.startsWith('</') &&
      !trimmedLine.startsWith('<!')) return true;

  return false;
}

function smartCodeSplit(text, maxLength) {
  const lines = text.split('\n');
  let parts = [];
  let currentPart = [];
  let currentLength = 0;
  
  for (let i = 0; i < lines.length; i++) {
    const line = lines[i];
    const lineLength = line.length + 1;
    
    currentPart.push(line);
    currentLength += lineLength;
    
    if (currentLength >= maxLength) {
      let cutPoint = i;
      const searchLimit = Math.min(lines.length - 1, i + 15);
      
      for (let j = i + 1; j <= searchLimit; j++) {
        const nextLine = lines[j];
        
        if (isGoodCutPoint(nextLine)) {
          cutPoint = j;
          break;
        }
      }
      
      if (cutPoint > i) {
        for (let k = i + 1; k <= cutPoint; k++) {
          currentPart.push(lines[k]);
          currentLength += lines[k].length + 1;
        }
      }
      
      parts.push(currentPart.join('\n'));
      currentPart = [];
      currentLength = 0;
      i = cutPoint;
    }
  }
  
  if (currentPart.length > 0) {
    parts.push(currentPart.join('\n'));
  }
  
  return parts;
}

// é–¢æ•°ãƒ¢ãƒ¼ãƒ‰: JavaScripté–¢æ•°ã”ã¨ã«æŠ½å‡º
function extractFunctions(text) {
  const results = [];
  const functionRegex = /function\s+(\w+)\s*\([^)]*\)\s*\{/g;
  let match;
  const functionStarts = [];
  
  // å…¨ã¦ã®é–¢æ•°ã®é–‹å§‹ä½ç½®ã‚’æ¤œå‡º
  while ((match = functionRegex.exec(text)) !== null) {
    functionStarts.push({
      name: match[1],
      start: match.index,
      fullMatch: match[0]
    });
  }
  
  // å„é–¢æ•°ã®çµ‚ã‚ã‚Šä½ç½®ã‚’è¦‹ã¤ã‘ã‚‹
  functionStarts.forEach((func, index) => {
    let braceCount = 1;
    let pos = func.start + func.fullMatch.length;
    
    // å¯¾å¿œã™ã‚‹é–‰ã˜æ‹¬å¼§ã‚’æ¢ã™
    while (pos < text.length && braceCount > 0) {
      if (text[pos] === '{') braceCount++;
      if (text[pos] === '}') braceCount--;
      pos++;
    }
    
    // æ¬¡ã®é–¢æ•°ã®é–‹å§‹ä½ç½®ã¾ãŸã¯æ–‡å­—åˆ—ã®çµ‚ã‚ã‚Šã¾ã§ã‚’å–å¾—
    const end = index < functionStarts.length - 1 ? functionStarts[index + 1].start : text.length;
    const functionCode = text.substring(func.start, pos);
    
    results.push({
      label: `âš™ï¸ ${func.name}()`,
      content: functionCode.trim()
    });
  });
  
  // é–¢æ•°ä»¥å¤–ã®éƒ¨åˆ†ã‚‚å–å¾—ï¼ˆæœ€åˆã®éƒ¨åˆ†ï¼‰
  if (functionStarts.length > 0 && functionStarts[0].start > 0) {
    const beforeFirst = text.substring(0, functionStarts[0].start).trim();
    if (beforeFirst) {
      results.unshift({
        label: 'ğŸ“„ é–¢æ•°å‰ã®ã‚³ãƒ¼ãƒ‰',
        content: beforeFirst
      });
    }
  }
  
  return results.length > 0 ? results : [{ label: 'é–¢æ•°ãªã—', content: text }];
}

// æ§‹æˆãƒ¢ãƒ¼ãƒ‰: htmlâ†’headâ†’bodyâ†’/html ã®è‡ªç„¶ãªæµã‚Œã§åˆ†å‰²
function extractComposition(html) {
  const results = [];
  
  // 1. HTMLé–‹å§‹éƒ¨åˆ†ï¼ˆDOCTYPE + <html> + <head>é–‹å§‹ã¾ã§ï¼‰
  const headStartMatch = html.match(/([\s\S]*?<head[^>]*>)/i);
  if (headStartMatch) {
    results.push({
      label: 'ğŸHTMLé–‹å§‹',
      content: headStartMatch[1]
    });
    
    // 2. Headå†…éƒ¨ï¼ˆ<head>ã‹ã‚‰</head>ã¾ã§ï¼‰
    const headMatch = html.match(/<head[^>]*>([\s\S]*?)<\/head>/i);
    if (headMatch) {
      const headContent = headMatch[1];
      
      // Headå†…ã‚’style/script/ãã®ä»–ã«åˆ†ã‘ã‚‹
      const styleMatches = [...headContent.matchAll(/<style[^>]*>[\s\S]*?<\/style>/gi)];
      const scriptMatches = [...headContent.matchAll(/<script[^>]*>[\s\S]*?<\/script>/gi)];
      
      // ã‚¹ã‚¿ã‚¤ãƒ«ä»¥å¤–ã®headå†…å®¹ã‚’å–å¾—
      let remainingHead = headContent;
      styleMatches.forEach(match => {
        remainingHead = remainingHead.replace(match[0], '');
      });
      scriptMatches.forEach(match => {
        remainingHead = remainingHead.replace(match[0], '');
      });
      
      // HeadåŸºæœ¬æƒ…å ±ï¼ˆmeta, titleãªã©ï¼‰
      if (remainingHead.trim()) {
        results.push({
          label: 'ğŸ“‹HeadåŸºæœ¬æƒ…å ±',
          content: remainingHead.trim() + '\n</head>'
        });
      }
      
      // ã‚¹ã‚¿ã‚¤ãƒ«
      styleMatches.forEach((match, i) => {
        results.push({
          label: `ğŸ¨ã‚¹ã‚¿ã‚¤ãƒ«${styleMatches.length > 1 ? ` ${i + 1}` : ''}`,
          content: match[0]
        });
      });
      
      // ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
      scriptMatches.forEach((match, i) => {
        results.push({
          label: `âš™ï¸ã‚¹ã‚¯ãƒªãƒ—ãƒˆ${scriptMatches.length > 1 ? ` ${i + 1}` : ''}`,
          content: match[0]
        });
      });
    }
    
    // 3. Bodyéƒ¨åˆ†
    const bodyMatch = html.match(/<body[^>]*>[\s\S]*?<\/body>/i);
    if (bodyMatch) {
      results.push({
        label: 'ğŸ“–Bodyæœ¬ä½“',
        content: bodyMatch[0]
      });
    }
    
    // 4. HTMLçµ‚äº†éƒ¨åˆ†
    const htmlEndMatch = html.match(/(<\/body>[\s\S]*?<\/html>[\s\S]*)$/i);
    if (htmlEndMatch) {
      results.push({
        label: 'ğŸHTMLçµ‚äº†',
        content: htmlEndMatch[1]
      });
    }
  } else {
    // headã‚¿ã‚°ãŒãªã„å ´åˆã¯å…¨ä½“ã‚’è¿”ã™
    results.push({
      label: 'ğŸ“„å…¨ä½“',
      content: html
    });
  }
  
  return results;
}

// æ§‹é€ ãƒ‘ãƒ¼ãƒ„ãƒ¢ãƒ¼ãƒ‰: head, style, script, bodyãªã©éƒ¨å“ã”ã¨ã«æŠ½å‡º
function extractStructureParts(html) {
  const results = [];

  // Headéƒ¨åˆ†æŠ½å‡ºï¼ˆstyleã‚’é™¤ãï¼‰
  const headMatch = html.match(/<head[^>]*>[\s\S]*?<\/head>/i);
  if (headMatch) {
    let headContent = headMatch[0];
    // styleã‚’é™¤å»
    headContent = headContent.replace(/<style[^>]*>[\s\S]*?<\/style>/gi, '');
    if (headContent.replace(/<\/?head[^>]*>/gi, '').trim()) {
      results.push({
        label: 'ğŸ“‹Headæƒ…å ±',
        content: headContent
      });
    }
  }

  // Styleéƒ¨åˆ†æŠ½å‡º
  const styleMatches = [...html.matchAll(/<style[^>]*>[\s\S]*?<\/style>/gi)];
  styleMatches.forEach((match, i) => {
    results.push({
      label: `ğŸ¨ã‚¹ã‚¿ã‚¤ãƒ«${styleMatches.length > 1 ? ` ${i + 1}` : ''}`,
      content: match[0]
    });
  });

  // Scriptéƒ¨åˆ†æŠ½å‡º
  const scriptMatches = [...html.matchAll(/<script[^>]*>[\s\S]*?<\/script>/gi)];
  scriptMatches.forEach((match, i) => {
    results.push({
      label: `âš™ï¸ã‚¹ã‚¯ãƒªãƒ—ãƒˆ${scriptMatches.length > 1 ? ` ${i + 1}` : ''}`,
      content: match[0]
    });
  });

  // Bodyéƒ¨åˆ†æŠ½å‡º
  const bodyMatch = html.match(/<body[^>]*>[\s\S]*?<\/body>/i);
  if (bodyMatch) {
    results.push({
      label: 'ğŸ“–Bodyæœ¬ä½“',
      content: bodyMatch[0]
    });
  }

  return results;
}

// head/bodyã‚«ãƒƒãƒˆ: </head>ã§çœŸã£äºŒã¤
function extractHeadBodySplit(html) {
  const results = [];
  
  const headEndIndex = html.indexOf('</head>');
  if (headEndIndex !== -1) {
    // Headéƒ¨åˆ†ï¼ˆ</head>ã¾ã§ï¼‰
    const headPart = html.substring(0, headEndIndex + 7);
    results.push({
      label: 'ğŸ”´Headéƒ¨åˆ†',
      content: headPart
    });
    
    // Bodyéƒ¨åˆ†ï¼ˆ</head>ä»¥é™ï¼‰
    const bodyPart = html.substring(headEndIndex + 7);
    if (bodyPart.trim()) {
      results.push({
        label: 'ğŸ”µBodyéƒ¨åˆ†',
        content: bodyPart
      });
    }
  } else {
    results.push({
      label: 'ğŸŸ£å…¨ä½“ï¼ˆheadåŒºåˆ‡ã‚Šãªã—ï¼‰',
      content: html
    });
  }
  
  return results;
}

function splitText() {
  const rawText = document.getElementById("longText").value;
  // æ®µè½ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯æ”¹è¡Œæ§‹é€ ã‚’å¤‰æ›´ã—ãªã„ï¼ˆä»–ã®ãƒ¢ãƒ¼ãƒ‰ã¯å¾“æ¥é€šã‚Šï¼‰
  const mode = document.querySelector('input[name="mode"]:checked').value;
  const text = mode === "smartParagraph" ? rawText : rawText.replace(/\n{3,}/g, '\n\n');
  const length = parseInt(document.getElementById("splitLength").value, 10);
  const resultArea = document.getElementById("resultArea");

  updateTotalStats();
  resultArea.innerHTML = "";
  document.getElementById("mixOutputArea").innerHTML = "";
  document.getElementById("countStatus").textContent = "ğŸ§®ãƒ‘ãƒ¼ãƒ„æ•°ï¼š0/0";

  if (!text) {
    showCutePopup("ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ã‹ã‚‰åˆ†å‰²ã—ã¦ã­â™ª", "ğŸ’¬STOPï¼");
    return;
  }

  let parts = [];

  if (mode === "novel") {
    parts = text.split(/\n{2,}/).map(p => p.trim()).filter(p => p.length > 0);
    displayParts(parts.map(p => ({ label: 'æ®µè½', content: p })));
  } else if (mode === "code") {
    if (isNaN(length) || length <= 0) {
      showCutePopup("åˆ†å‰²æ–‡å­—æ•°ã¯æ­£ã®æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ã­ğŸ’«", "âš ï¸ å…¥åŠ›ãƒŸã‚¹ã‹ã‚‚ï¼Ÿ");
      return;
    }
    parts = smartCodeSplit(text, length);
    displayParts(parts.map((p, i) => ({ label: `ã‚³ãƒ¼ãƒ‰ ${i + 1}`, content: p })));
  } else if (mode === "function") {
    const functionParts = extractFunctions(text);
    displayParts(functionParts);
  } else if (mode === "composition") {
    const compositionParts = extractComposition(text);
    displayParts(compositionParts);
  } else if (mode === "structureParts") {
    const structureParts = extractStructureParts(text);
    displayParts(structureParts);
  } else if (mode === "headBodySplit") {
    const headBodyParts = extractHeadBodySplit(text);
    displayParts(headBodyParts);
  } else if (mode === "symbolCut") {
    const symbolParts = splitBySymbolOnlyLines(text, false);
    displayParts(
    symbolParts.map((p, i) => ({
      label: `ğŸ”»åŒºåˆ‡ã‚Š ${i + 1}`,
      content: p
    }))
  );
  } else if (mode === "smartParagraph") {
    if (isNaN(length) || length <= 0) {
      showCutePopup("åˆ†å‰²æ–‡å­—æ•°ã¯æ­£ã®æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ã­ğŸ’«", "âš ï¸ å…¥åŠ›ãƒŸã‚¹ã‹ã‚‚ï¼Ÿ");
      return;
    }
    const paragraphParts = splitRespectParagraph(text, length);
    displayParts(paragraphParts.map((p, i) => ({ label: `æ®µè½æŸ ${i + 1}`, content: p })));
  } else {
    // æ–‡å­—æ•°ãƒ¢ãƒ¼ãƒ‰
    if (isNaN(length) || length <= 0) {
      showCutePopup("åˆ†å‰²æ–‡å­—æ•°ã¯æ­£ã®æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ã­ğŸ’«", "âš ï¸ å…¥åŠ›ãƒŸã‚¹ã‹ã‚‚ï¼Ÿ");
      return;
    }
    
    // æ”¹è¡Œã‚’é™¤å»ã—ã¦ã‹ã‚‰åˆ†å‰²
    const cleanText = text.replace(/\n/g, '');
    for (let i = 0; i < cleanText.length; i += length) {
      parts.push(cleanText.substring(i, i + length));
    }
    displayParts(parts.map((p, i) => ({ label: `ãƒ†ã‚­ã‚¹ãƒˆ${i + 1}`, content: p })));
  }
}

function displayParts(parts) {
  const resultArea = document.getElementById("resultArea");
  
  const totalParts = parts.length;
  parts.forEach((partData, index) => {
    const char = characters[Math.floor(Math.random() * characters.length)];
    const comment = char.comments[Math.floor(Math.random() * char.comments.length)];
    const part = partData.content || partData;
    const label = partData.label || `ãƒ‘ãƒ¼ãƒ„ ${index + 1}`;

    const wrapper = document.createElement("div");
    wrapper.className = "part-label-wrapper";

    const partLabel = document.createElement("div");
    partLabel.className = "part-label";
    const charCount = part.length;
    const lineCount = part.split("\n").length;
    partLabel.textContent = `${label}ãƒ»${index + 1}/${totalParts}ï¼ˆ${charCount}æ–‡å­—ãƒ»${lineCount}è¡Œï¼‰`;

    const check = document.createElement("input");
    check.type = "checkbox";
    check.checked = true;
    check.className = "part-check";
    check.name = "partSelect";
    check.addEventListener("change", updateCount);

    wrapper.appendChild(partLabel);
    wrapper.appendChild(check);
    resultArea.appendChild(wrapper);

    const commentDiv = document.createElement("div");
    commentDiv.className = "comment";
    commentDiv.textContent = `ã€${char.name}ã€‘${comment}`;
    resultArea.appendChild(commentDiv);

    const partBox = document.createElement("textarea");
    // å…ˆé ­ã®æ”¹è¡Œãƒ»ç©ºç™½ãƒ»ä¸å¯è¦–æ–‡å­—ã‚’å‰Šé™¤ï¼ˆtextarea ã®å…ˆé ­ç©ºç™½ã‚’é˜²ãï¼‰
    let cleanedPart = part.replace(/^[\u200B\uFEFF]+/, '');
    partBox.value = cleanedPart;
    partBox.className = "part-box";
    // é«˜ã•ã¯CSSã§å›ºå®šï¼ˆ200pxï¼‰ã®ãŸã‚ã€rowsã¯è¨­å®šã—ãªã„
    partBox.style.marginBottom = "10px";
    resultArea.appendChild(partBox);

    const copyBtn = document.createElement("button");
    copyBtn.className = "copy-button";
    copyBtn.textContent = "â‡ï¸ã‚³ãƒ”ãƒ¼ã™ã‚‹";
    copyBtn.addEventListener("click", () => {
      navigator.clipboard.writeText(partBox.value).then(() => {
        // ã‚³ãƒ”ãƒ¼å®Œäº†çŠ¶æ…‹ã«ãªã£ãŸã‚‰æˆ»ã•ãªã„
        copyBtn.textContent = "ğŸŒ™ã‚³ãƒ”ãƒ¼å®Œäº†";
        copyBtn.classList.add("copied");
        // setTimeoutã‚’å‰Šé™¤ã—ã¦ã€æ°¸ç¶šçš„ã«ã‚³ãƒ”ãƒ¼å®Œäº†çŠ¶æ…‹ã‚’ä¿æŒ
      }).catch(err => {
        console.error('ã‚³ãƒ”ãƒ¼å¤±æ•—:', err);
      });
    });
    resultArea.appendChild(copyBtn);
  });

  updateCount();
}

function showToast(msg) {
  const toast = document.getElementById("leftToast");
  toast.textContent = msg;
  
  // ç”»é¢ä¸­å¤®ä¸Šéƒ¨ã«å›ºå®šè¡¨ç¤º
  toast.style.position = "fixed";
  toast.style.left = "50%";
  toast.style.top = "20px";
  toast.style.bottom = "auto";
  toast.style.transform = "translateX(-50%)";
  toast.style.zIndex = 9999;
  toast.style.opacity = "1";
  
  setTimeout(() => {
    toast.style.opacity = "0";
  }, 1000);
}

function selectAllParts() {
  document.querySelectorAll('.part-check').forEach(cb => cb.checked = true);
  updateCount();
  showToast('å…¨é¸æŠã—ãŸã‚ˆï¼');
}

function deselectAllParts() {
  document.querySelectorAll('.part-check').forEach(cb => cb.checked = false);
  updateCount();
  showToast('å…¨éƒ¨è§£é™¤ã—ãŸã‚ˆï¼');
}

function mixSelectedParts() {
  const resultArea = document.getElementById("resultArea");
  const checks = resultArea.querySelectorAll('.part-check');
  const texts = resultArea.querySelectorAll('.part-box');
  
  // 1. ãƒŸãƒƒã‚¯ã‚¹å¯¾è±¡ã®é¸ã³æ–¹
  // ãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ãƒ‘ãƒ¼ãƒ„ãŒ1ã¤ä»¥ä¸Šã‚ã‚‹å ´åˆ â†’ ãã®ãƒ‘ãƒ¼ãƒ„ã ã‘ã‚’ãƒŸãƒƒã‚¯ã‚¹å¯¾è±¡ã«ã™ã‚‹
  // ãƒã‚§ãƒƒã‚¯ãŒ0ã®å ´åˆ â†’ å…¨ãƒ‘ãƒ¼ãƒ„ã‚’ãƒŸãƒƒã‚¯ã‚¹å¯¾è±¡ã«ã™ã‚‹
  const selected = [];
  const selectedIndices = [];
  
  const checkedCount = Array.from(checks).filter(cb => cb.checked).length;
  
  if (checkedCount > 0) {
    // ãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ãƒ‘ãƒ¼ãƒ„ã ã‘ã‚’å¯¾è±¡
    checks.forEach((cb, i) => {
      if (cb.checked) {
        let part = texts[i].value.replace(/\n+$/, '');
        part = part.replace(/^[\u200B\uFEFF\s\n]+/, '');
        selected.push(part);
        selectedIndices.push(i + 1); // ãƒ‘ãƒ¼ãƒ„ç•ªå·ï¼ˆ1å§‹ã¾ã‚Šï¼‰
      }
    });
  } else {
    // ãƒã‚§ãƒƒã‚¯ãŒ0 â†’ å…¨ãƒ‘ãƒ¼ãƒ„ã‚’å¯¾è±¡
    checks.forEach((cb, i) => {
      let part = texts[i].value.replace(/\n+$/, '');
      part = part.replace(/^[\u200B\uFEFF\s\n]+/, '');
      selected.push(part);
      selectedIndices.push(i + 1);
    });
  }
  
  if (selected.length === 0) {
    showCutePopup("ãƒ‘ãƒ¼ãƒ„ãŒãªã„ã‚ˆğŸ’«<br>å…ˆã«åˆ†å‰²ã—ã¦ã‹ã‚‰ãƒŸãƒƒã‚¯ã‚¹ã—ã¦ã­â™ª", "ğŸ’¬STOPï¼");
    return;
  }
  

  // 2. æ–‡å­—æ•°ã®æ‰±ã„
  // ãƒŸãƒƒã‚¯ã‚¹æ–‡å­—æ•°æ¬„ãŒç©ºæ¬„ã®å ´åˆ â†’ ä¸Šé™ãªã—ã§å…¨éƒ¨é€£çµï¼ˆãƒ•ãƒ«ãƒŸãƒƒã‚¯ã‚¹ï¼‰
  // ãƒŸãƒƒã‚¯ã‚¹æ–‡å­—æ•°æ¬„ã«æ•°å€¤ãŒã‚ã‚‹å ´åˆ â†’ æŒ‡å®šæ–‡å­—æ•°ã®ä¸Šé™ã¾ã§é€£çµï¼ˆåˆ¶é™ãƒŸãƒƒã‚¯ã‚¹ï¼‰
  const mixMaxLengthInput = document.getElementById("mixMaxLength");
  const inputValue = mixMaxLengthInput ? mixMaxLengthInput.value.trim() : '';
  const maxLength = inputValue === '' ? null : parseInt(inputValue, 10);
  
  // å…¥åŠ›ãƒã‚§ãƒƒã‚¯: æ•°å­—ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹ãŒç„¡åŠ¹ãªå ´åˆã¯ã‚¨ãƒ©ãƒ¼
  if (inputValue !== '' && (isNaN(maxLength) || maxLength <= 0)) {
    showCutePopup("ãƒŸãƒƒã‚¯ã‚¹æ–‡å­—æ•°ã‚’ã¡ã‚ƒã‚“ã¨å…¥åŠ›ã—ã¦ã­ğŸ’«<br>ï¼ˆç©ºæ¬„ã§å…¨çµåˆã‚‚ã§ãã‚‹ã‚ˆâ™ªï¼‰", "âš ï¸ å…¥åŠ›ãƒŸã‚¹ã‹ã‚‚ï¼Ÿ");
    return;
  }
  
  // 3. ãƒ‘ãƒ¼ãƒˆç”Ÿæˆï¼ˆæŒ‡å®šæ–‡å­—æ•°ã§åˆ†å‰²ï¼‰
  const parts = [];
  
  // å…¨ãƒ‘ãƒ¼ãƒ„ã‚’çµåˆ
  const fullMix = selected.join("\n\n\n");
  const cleanedFullMix = fullMix.replace(/^[\u200B\uFEFF\s\n]+/, '');
  
  if (maxLength === null || maxLength === undefined) {
    // ä¸Šé™ãªã—ï¼ˆãƒ•ãƒ«ãƒŸãƒƒã‚¯ã‚¹ï¼‰â†’ 1ãƒ‘ãƒ¼ãƒˆã¨ã—ã¦å‡ºåŠ›
    parts.push({
      text: cleanedFullMix,
      partNumber: 1,
      charCount: cleanedFullMix.length,
      lineCount: cleanedFullMix.split("\n").length,
      partsUsed: selectedIndices
    });
  } else {
    // æŒ‡å®šæ–‡å­—æ•°ã§ãƒ‘ãƒ¼ãƒˆåˆ†å‰²
    let currentPartText = "";
    let currentPartNumber = 1;
    let currentPartsUsed = [];
    
    for (let i = 0; i < selected.length; i++) {
      const part = selected[i];
      const separator = currentPartText === "" ? "" : "\n\n\n";
      const candidate = currentPartText === "" ? part : currentPartText + separator + part;
      
      if (candidate.length <= maxLength) {
        // ã¾ã è¿½åŠ ã§ãã‚‹
        currentPartText = candidate;
        currentPartsUsed.push(selectedIndices[i]);
      } else {
        // ç¾åœ¨ã®ãƒ‘ãƒ¼ãƒˆã‚’ç¢ºå®š
        if (currentPartText.length > 0) {
          const cleaned = currentPartText.replace(/^[\u200B\uFEFF\s\n]+/, '');
          parts.push({
            text: cleaned,
            partNumber: currentPartNumber,
            charCount: cleaned.length,
            lineCount: cleaned.split("\n").length,
            partsUsed: [...currentPartsUsed]
          });
          currentPartNumber++;
        }
        
        // æ–°ã—ã„ãƒ‘ãƒ¼ãƒˆã‚’é–‹å§‹
        // ã“ã®ãƒ‘ãƒ¼ãƒ„ã ã‘ã§ä¸Šé™ã‚’è¶…ãˆã‚‹å ´åˆã¯ã€å¼·åˆ¶çš„ã«1ãƒ‘ãƒ¼ãƒˆã¨ã™ã‚‹
        if (part.length > maxLength) {
          const cleaned = part.replace(/^[\u200B\uFEFF\s\n]+/, '');
          parts.push({
            text: cleaned,
            partNumber: currentPartNumber,
            charCount: cleaned.length,
            lineCount: cleaned.split("\n").length,
            partsUsed: [selectedIndices[i]]
          });
          currentPartNumber++;
          currentPartText = "";
          currentPartsUsed = [];
        } else {
          currentPartText = part;
          currentPartsUsed = [selectedIndices[i]];
        }
      }
    }
    
    // æœ€å¾Œã®ãƒ‘ãƒ¼ãƒˆã‚’è¿½åŠ 
    if (currentPartText.length > 0) {
      const cleaned = currentPartText.replace(/^[\u200B\uFEFF\s\n]+/, '');
      parts.push({
        text: cleaned,
        partNumber: currentPartNumber,
        charCount: cleaned.length,
        lineCount: cleaned.split("\n").length,
        partsUsed: currentPartsUsed
      });
    }
  }
  
  // 4. å‡ºåŠ›ç”Ÿæˆ
  let output = '';
  
  parts.forEach((part, index) => {
    const partId = index === 0 ? 'finalMix' : `finalMixPart${part.partNumber}`;
    const copyFunc = index === 0 ? 'copyFinalMix' : `copyFinalMixPart${part.partNumber}`;
    const partsUsedText = part.partsUsed.length > 0 
      ? `ï¼ˆãƒ‘ãƒ¼ãƒ„${part.partsUsed.join('ã€')}ã‚’ãƒŸãƒƒã‚¯ã‚¹ï¼‰`
      : '';
    
    if (index > 0) {
      output += `<div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #ddd;">`;
    }
    
    output += `
      <h3>ğŸ“’ãƒŸãƒƒã‚¯ã‚¹çµæœï¼ˆãƒ‘ãƒ¼ãƒˆ${part.partNumber}ï¼‰ï¼š</h3>
      <textarea class="part-box" style="width:100%;" id="${partId}">${part.text}</textarea>
      <div style="margin: 10px 0 14px 0; color: #555; font-weight: bold; line-height: 1.5;">
        ğŸ“„ãƒŸãƒƒã‚¯ã‚¹æ–‡å­—æ•°ï¼š${part.charCount}æ–‡å­—ãƒ»${part.lineCount}è¡Œ ${partsUsedText}
      </div>
      <button class="mix-copy-button" id="${copyFunc}Button" data-target="${partId}">â˜€ï¸ã‚³ãƒ”ãƒ¼ã™ã‚‹</button>
    `;
    
    if (index > 0) {
      output += `</div>`;
    }
  });

  document.getElementById("mixOutputArea").innerHTML = output;
  
  // ç”Ÿæˆã—ãŸãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
  document.querySelectorAll(".mix-copy-button").forEach(btn => {
    const targetId = btn.getAttribute("data-target");
    if (targetId) {
      btn.addEventListener("click", () => {
        const targetBox = document.getElementById(targetId);
        if (targetBox) {
          navigator.clipboard.writeText(targetBox.value).then(() => {
            btn.textContent = "ğŸŒã‚³ãƒ”ãƒ¼å®Œäº†";
            btn.classList.add("mix-copied");
          }).catch(err => {
            console.error('ã‚³ãƒ”ãƒ¼å¤±æ•—:', err);
          });
        }
      });
    }
  });
}

function copyFinalMix() {
  const mixBox = document.getElementById("finalMix");
  const btn = document.getElementById("finalMixButton");
  if (!mixBox || !btn) {
    console.error('ãƒŸãƒƒã‚¯ã‚¹çµæœã¾ãŸã¯ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
    return;
  }
  navigator.clipboard.writeText(mixBox.value).then(() => {
    btn.textContent = "ğŸŒã‚³ãƒ”ãƒ¼å®Œäº†";
    btn.classList.add("mix-copied");
  }).catch(err => {
    console.error('ã‚³ãƒ”ãƒ¼å¤±æ•—:', err);
  });
}

// ãƒ‘ãƒ¼ãƒˆ2ä»¥é™ã®ã‚³ãƒ”ãƒ¼é–¢æ•°ï¼ˆå‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ãƒ‘ãƒ¼ãƒˆç”¨ï¼‰
// ãƒ‘ãƒ¼ãƒˆã”ã¨ã«å€‹åˆ¥ã®ã‚³ãƒ”ãƒ¼é–¢æ•°ãŒç”Ÿæˆã•ã‚Œã‚‹ãŸã‚ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‹ã‚‰å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ã™ã‚‹
function copyFinalMixPart2() { copyMixPart(2); }
function copyFinalMixPart3() { copyMixPart(3); }
function copyFinalMixPart4() { copyMixPart(4); }
function copyFinalMixPart5() { copyMixPart(5); }
function copyFinalMixPart6() { copyMixPart(6); }
function copyFinalMixPart7() { copyMixPart(7); }
function copyFinalMixPart8() { copyMixPart(8); }
function copyFinalMixPart9() { copyMixPart(9); }
function copyFinalMixPart10() { copyMixPart(10); }

function copyMixPart(partNumber) {
  const partBox = document.getElementById(`finalMixPart${partNumber}`);
  const btn = document.getElementById(`copyFinalMixPart${partNumber}Button`);
  if (partBox && btn) {
    navigator.clipboard.writeText(partBox.value).then(() => {
      btn.textContent = "ğŸŒã‚³ãƒ”ãƒ¼å®Œäº†";
      btn.classList.add("mix-copied");
    }).catch(err => {
      console.error('ã‚³ãƒ”ãƒ¼å¤±æ•—:', err);
    });
  }
}


function scrollToTop() {
  window.scrollTo({ top: 0, behavior: 'smooth' });
  showToast('ã„ã¡ã°ã‚“ä¸Šã«è¡Œãã‚ˆï¼');
}

function scrollToBottom() {
  window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
  showToast('ã„ã¡ã°ã‚“ä¸‹ã¾ã§è¡Œãã‚ˆï¼');
}

// ãºãŸã‚¹ãƒšãƒ¼ã‚¹æ‹¡å¤§/ç¸®å°æ©Ÿèƒ½
let isPetaExpanded = false;

function togglePetaFullscreen(event) {
  if (event) {
    event.stopPropagation(); // ã‚¤ãƒ™ãƒ³ãƒˆã®ä¼æ’­ã‚’æ­¢ã‚ã‚‹
  }
  const modal = document.getElementById("petaModal");
  const textarea = document.getElementById("petaArea");
  
  // â™ªãƒœã‚¿ãƒ³ã§ã€Œæ‹¡å¤§ï¼ç¸®å°ã€ã‚’ãƒˆã‚°ãƒ«ã™ã‚‹
  if (!isPetaExpanded) {
    // æ‹¡å¤§
    modal.classList.add("expanded");
    if (textarea) {
      textarea.style.fontSize = "16px";
    }
    isPetaExpanded = true;
  } else {
    // ç¸®å°
    modal.classList.remove("expanded");
    if (textarea) {
      textarea.style.height = "";
      textarea.style.fontSize = "";
    }
    isPetaExpanded = false;
  }
}

// ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã§ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹
window.togglePetaFullscreen = togglePetaFullscreen;

// ãºãŸãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
let petaMode = "1è¡Œ"; // åˆæœŸã¯ãƒ’ãƒãƒã‚®ãƒ¢ãƒ¼ãƒ‰

document.getElementById("petaModeToggle").addEventListener("click", () => {
  const btn = document.getElementById("petaModeToggle");
  if (petaMode === "1è¡Œ") {
    // â†’ ã‚¶ã‚¯ãƒ©ãƒ³ãƒ¢ãƒ¼ãƒ‰ï¼ˆ3è¡Œãƒ»âœ´ï¸ï¸ï¼‰
    petaMode = "3è¡Œ";
    btn.textContent = "âœ´ï¸ï¸3è¡Œãƒ¢ãƒ¼ãƒ‰";
    btn.classList.remove("scientist");
    btn.classList.add("astro");
  } else {
    // â†’ ãƒ’ãƒãƒã‚®ãƒ¢ãƒ¼ãƒ‰ï¼ˆ1è¡Œãƒ»ğŸ’¡ï¼‰
    petaMode = "1è¡Œ";
    btn.textContent = "ğŸ’¡1è¡Œãƒ¢ãƒ¼ãƒ‰";
    btn.classList.remove("astro");
    btn.classList.add("scientist");
  }
  showToast(`ğŸ“ãºãŸãƒ¢ãƒ¼ãƒ‰ï¼šç¾åœ¨ã¯ã€Œ${petaMode}ã€ãƒ¢ãƒ¼ãƒ‰ã ã‚ˆï¼`);
});

// ãºãŸã‚¹ãƒšãƒ¼ã‚¹æ©Ÿèƒ½
document.getElementById("openPeta").addEventListener("click", () => {
  const modal = document.getElementById("petaModal");
  modal.style.display = "block";
  // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹ãŸã‚ã«å°‘ã—é…å»¶
  setTimeout(() => {
    modal.classList.add("show");
  }, 10);
});

document.getElementById("closePeta").addEventListener("click", () => {
  const modal = document.getElementById("petaModal");
  modal.classList.remove("show");
  modal.classList.remove("expanded");
  isPetaExpanded = false;
  const textarea = document.getElementById("petaArea");
  if (textarea) {
    textarea.style.height = "";
    textarea.style.fontSize = "";
  }
  setTimeout(() => {
    modal.style.display = "none";
  }, 400); // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“ã«åˆã‚ã›ã‚‹
});

// èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§ã‚‚é–‰ã˜ã‚‹
document.getElementById("petaModal").addEventListener("click", (e) => {
  // èª¤ã‚¿ãƒƒãƒ—ã§å‹æ‰‹ã«é–‰ã˜ãªã„ã‚ˆã†ã«ã€èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§ã¯é–‰ã˜ãªã„
  return;
});

// ESCã‚­ãƒ¼ã§ã‚‚é–‰ã˜ã‚‹
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape" && document.getElementById("petaModal").classList.contains("show")) {
    const modal = document.getElementById("petaModal");
    modal.classList.remove("show");
    modal.classList.remove("expanded");
    isPetaExpanded = false;
    const textarea = document.getElementById("petaArea");
    if (textarea) {
      textarea.style.height = "";
      textarea.style.fontSize = "";
    }
    setTimeout(() => {
      modal.style.display = "none";
    }, 400);
  }
});

// ğŸ“ ãºãŸã‚¹ãƒšãƒ¼ã‚¹ã®æ–‡å­—æ•°ã‚’æ›´æ–°
function updatePetaCount() {
  const text = document.getElementById("petaArea").value;
  const count = text.replace(/\n/g, "").length;  // æ”¹è¡Œé™¤ã„ã¦æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆ
  document.getElementById("petaCharCount").textContent = `ğŸ“æ–‡å­—æ•°ï¼š${count}å­—`;
}

// ğŸ“‹ãºãŸã£ï¼ â†’ æ•´å½¢ï¼‹è¿½è¨˜ï¼
document.getElementById("petaPaste").addEventListener("click", async () => {
  try {
    const clipText = await navigator.clipboard.readText();
    if (!clipText) {
      showCutePopup("ğŸ“‹ãºãŸã‚¹ãƒšãƒ¼ã‚¹ï¼šã‚³ãƒ”ãƒ¼å†…å®¹ãŒç©ºã ã‚ˆã€œ", "ğŸ’¬STOPï¼");
      return;
    }

    // ğŸ“ å¡Šã¨ã—ã¦æ‰±ã†ï¼šãƒ†ã‚­ã‚¹ãƒˆå…¨ä½“ã‚’1ã¤ã®å¡Šã¨ã—ã¦ä¿æŒï¼ˆåˆ†è£‚ã•ã›ãªã„ï¼‰
    // æœ«å°¾ã®ä¸è¦ãªæ”¹è¡Œã‚’å‰Šé™¤ã—ã¦æ•´å½¢
    const formatted = clipText.trimEnd();

    const peta = document.getElementById("petaArea");
    // ğŸ“Œ è¿½è¨˜ï¼ˆãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ã¦æ”¹è¡Œã‚’å¤‰æ›´ï¼š1è¡Œãƒ¢ãƒ¼ãƒ‰=\nã€3è¡Œãƒ¢ãƒ¼ãƒ‰=\n\n\nï¼‰
    const separator = petaMode === "3è¡Œ" ? "\n\n\n" : "\n";
    peta.value += (peta.value ? separator : "") + formatted;
    
    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ€ä¸‹éƒ¨ã«
    peta.scrollTop = peta.scrollHeight;
    
    // ä¿å­˜
    localStorage.setItem("petaLite", peta.value);
    
    // æ–‡å­—æ•°æ›´æ–°
    updatePetaCount();
    
    showToast("ãºãŸã£ï¼æ–‡å­—ã‚’è¿½åŠ ã—ãŸã‚ˆã£âœ¨");
  } catch (e) {
    showCutePopup("ğŸ˜¢ãºãŸå¤±æ•—ã—ã¡ã‚ƒã£ãŸâ€¦<br>ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã®èª­ã¿å–ã‚Šã«å¤±æ•—ã—ã¾ã—ãŸ", "âš ï¸ã‚¨ãƒ©ãƒ¼");
  }
});

// â†© æˆ»ã™ â†’ æœ€å¾Œã®ãºãŸã ã‘ã‚’å‰Šé™¤
document.getElementById("petaUndo").addEventListener("click", () => {
  const peta = document.getElementById("petaArea");
  const currentText = peta.value.trimEnd();
  
  // ç©ºã®å ´åˆã¯ä½•ã‚‚ã—ãªã„
  if (!currentText) {
    showToast("â†© æˆ»ã™ã‚‚ã®ãŒãªã„ã‚ˆã€œ");
    return;
  }
  
  // åˆ†å‰²æ–¹æ³•ï¼ˆ1è¡Œ or 3è¡Œï¼‰ã‚’å‹•çš„ã«åˆ¤å®š
  const is3LineMode = petaMode === "3è¡Œ";
  const separator = is3LineMode ? "\n\n\n" : "\n";
  
  // åŒºåˆ‡ã‚Šã§åˆ†å‰²
  const parts = currentText.split(separator);
  
  if (parts.length <= 1) {
    // 1ã¤ã—ã‹ãªã„å ´åˆã¯å…¨éƒ¨æ¶ˆã™
    peta.value = "";
  } else {
    // æœ€å¾Œã®å¡Šã ã‘å‰Šé™¤
    parts.pop();
    peta.value = parts.join(separator);
  }
  
  // ä¿å­˜ã¨æ›´æ–°
  localStorage.setItem("petaLite", peta.value);
  
  // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ€ä¸‹éƒ¨ã«
  peta.scrollTop = peta.scrollHeight;
  
  // æ–‡å­—æ•°æ›´æ–°
  updatePetaCount();
  
  showToast("â†©æœ€å¾Œã®ãºãŸã‚’æˆ»ã—ãŸã‚ˆã£ï¼");
});

// ğŸ—‘ãºãŸæ¶ˆå» â†’ ãºãŸã‚¹ãƒšãƒ¼ã‚¹ã‚’ã‚¯ãƒªã‚¢
document.getElementById("petaClear").addEventListener("click", () => {
  document.getElementById("petaArea").value = "";
  localStorage.removeItem("petaLite");
  updatePetaCount();
  showToast("ğŸ—‘ãºãŸã‚¹ãƒšãƒ¼ã‚¹ã‚’ãã‚Œã„ã«ãŠæƒé™¤ã—ãŸã‚ˆã£âœ¨");
});

// ğŸ“„ã‚³ãƒ”ãƒ¼ â†’ ãºãŸã‚¹ãƒšãƒ¼ã‚¹ã®å†…å®¹ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
document.getElementById("petaCopy").addEventListener("click", () => {
  const petaText = document.getElementById("petaArea").value;
  if (!petaText) {
    showCutePopup("ã‚³ãƒ”ãƒ¼ã®å‰ã«ã€ãºãŸã‚¹ãƒšãƒ¼ã‚¹ã«ä½•ã‹å…¥ã‚Œã¦ã­ï¼", "ğŸ’¬STOPï¼");
    return;
  }
  navigator.clipboard.writeText(petaText)
    .then(() => {
      showToast("ğŸªã‚³ãƒ”ãƒ¼å®Œäº†ï¼å†…å®¹ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«é€ã£ãŸã‚ˆã£âœ¨");
    })
    .catch(() => {
      showCutePopup("ã‚³ãƒ”ãƒ¼å¤±æ•—ã—ã¡ã‚ƒã£ãŸâ€¦è¨±å¯ãŒå¿…è¦ã‹ã‚‚ï¼", "âš ï¸ã‚¨ãƒ©ãƒ¼");
    });
});

// ğŸ’¾ãºãŸã‚¹ãƒšãƒ¼ã‚¹ã®ä¸€æ™‚ä¿å­˜æ©Ÿèƒ½
// ã€1ã€‘å…¥åŠ›ã®ãŸã³ã«ä¿å­˜ï¼ˆä»–ã®ã‚¿ãƒ–ç§»å‹•ä¸­ã¯æ®‹ã™ï¼‰
document.getElementById("petaArea").addEventListener("input", () => {
  localStorage.setItem("petaLite", document.getElementById("petaArea").value);
  updatePetaCount();
});

// ã€2ã€‘ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å¾©å…ƒï¼ˆæˆ»ã£ã¦ããŸæ™‚ã«è¡¨ç¤ºï¼‰
window.addEventListener("load", () => {
  const saved = localStorage.getItem("petaLite");
  if (saved) {
    document.getElementById("petaArea").value = saved;
  }
  updatePetaCount();
});

// ã€3ã€‘ã€Œãƒšãƒ¼ã‚¸æ›´æ–°ã€orã€Œã‚¿ãƒ–é–‰ã˜ã€æ™‚ã«å‰Šé™¤ï¼
window.addEventListener("beforeunload", () => {
  localStorage.removeItem("petaLite");
});

function splitRespectParagraph(text, maxLen) {
  const parts = [];

  // æ”¹è¡ŒãŒãªã„å ´åˆï¼šå˜ç´”ã«æ–‡å­—æ•°ã§åˆ‡ã‚‹
  if (!text.includes('\n')) {
    for (let i = 0; i < text.length; i += maxLen) {
      parts.push(text.slice(i, i + maxLen));
    }
    return parts;
  }

  // æ”¹è¡ŒãŒã‚ã‚‹å ´åˆï¼šæ®µè½å˜ä½ã§æŸã­ã‚‹
  const paragraphs = text.split(/\n{2,}/);
  let current = "";

  paragraphs.forEach(p => {
    if ((current + "\n\n" + p).length <= maxLen) {
      current += (current ? "\n\n" : "") + p;
    } else {
      if (current) parts.push(current);
      current = p;
    }
  });

  if (current) parts.push(current);

  return parts;
}

// è¨˜å·ã ã‘ã®è¡Œï¼ˆâ—, â—†â—†â—†ãªã©ï¼‰ã§åˆ†å‰²
function splitBySymbolOnlyLines(text, keepDelimiter = false) {
  // åˆ¶å¾¡æ–‡å­—å¯¾ç­–ï¼ˆç¸¦ã‚¿ãƒ–ãªã©ï¼‰
  text = text.replace(/\u000b/g, '\n');

  const lines = text.replace(/\r\n?/g, '\n').split('\n');
  const parts = [];
  let buffer = [];

const isSymbolOnlyLine = (line) => {
  const t = line.trim();
  if (!t) return false;

  // æ–‡å­—ãƒ»æ•°å­—ï¼ˆæ—¥æœ¬èªå«ã‚€ï¼‰ãŒã‚ã‚Œã°NG
  if (/[A-Za-z0-9\u3040-\u30FF\u3400-\u9FFF]/.test(t)) return false;

  // åŒºåˆ‡ã‚Šã¨ã—ã¦è¨±å¯ã™ã‚‹è¨˜å·ã ã‘
  const allowedSymbols = /^[â—â—†â– â—‡â–¡â–²â–¼ï¼Š*]+$/;
  return allowedSymbols.test(t);
};

  const flush = () => {
    const chunk = buffer.join('\n').trim();
    if (chunk) parts.push(chunk);
    buffer = [];
  };

  for (const line of lines) {
    if (isSymbolOnlyLine(line)) {
      flush();
      if (keepDelimiter) {
        parts.push(line.trim());
      }
    } else {
      buffer.push(line);
    }
  }

  flush();
  return parts;
}

</script>
</body>

<!-- ç”»é¢å³ä¸‹ã«æµ®ããƒœã‚¿ãƒ³ç¾¤ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ -->
<div id="scrollButtons">
  <button onclick="selectAllParts()" title="å…¨é¸æŠ">ğŸ”›ï¸</button>
  <button onclick="deselectAllParts()" title="å…¨è§£é™¤">ğŸ”™</button>
  <button onclick="scrollToTop()" title="ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹">ğŸ”</button>
  <button onclick="scrollToBottom()" title="ä¸€ç•ªä¸‹ã¸">ğŸ”š</button>
</div>

<div id="leftToast"></div>

<div style="height: 100px;"></div>
</html>